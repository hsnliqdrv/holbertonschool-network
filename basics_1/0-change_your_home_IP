#!/usr/bin/env bash
# Configures the local /etc/hosts file to redirect specific domains
# Bypasses SC2001 by avoiding sed on variables and using a subshell stream

# Use a subshell to process the file and pipe the whole output to tee
{
    while IFS= read -r line; do
        if [[ "$line" == *"localhost"* ]]; then
            # Replace localhost line using Bash expansion
            echo "${line/127.0.0.1/127.0.0.2}"
        elif [[ "$line" == *"facebook.com"* ]]; then
            # Replace facebook.com line
            echo "8.8.8.8 facebook.com"
        else
            echo "$line"
        fi
    done < /etc/hosts

    # If facebook.com wasn't in the file, we add it at the end
    if ! grep -q "facebook.com" /etc/hosts; then
        echo "8.8.8.8 facebook.com"
    fi
} | sudo tee /etc/hosts > /dev/null