#!/usr/bin/env bash
# Configures the local /etc/hosts file to redirect specific domains
# Uses a method compatible with Docker/mounted files

# Step 1: Read the current hosts file, modify it in memory, and overwrite
HOSTS_CONTENT=$(cat /etc/hosts)

# Requirement 1: Change localhost to resolve to 127.0.0.2
# We replace 127.0.0.1 with 127.0.0.2 specifically for the localhost entry
HOSTS_CONTENT=$(echo "$HOSTS_CONTENT" | sed 's/127.0.0.1\s*localhost/127.0.0.2 localhost/')

# Requirement 2: Make facebook.com resolve to 8.8.8.8
# Check if facebook.com exists; if so, replace. If not, append.
if echo "$HOSTS_CONTENT" | grep -q "facebook.com"; then
    HOSTS_CONTENT=$(echo "$HOSTS_CONTENT" | sed 's/.*facebook.com/8.8.8.8 facebook.com/')
else
    HOSTS_CONTENT="${HOSTS_CONTENT}\n8.8.8.8 facebook.com"
fi

# Step 3: Use tee to overwrite /etc/hosts (this works where sed -i fails)
echo -e "$HOSTS_CONTENT" | sudo tee /etc/hosts > /dev/null